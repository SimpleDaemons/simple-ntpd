# High-Performance NTP Server Configuration
# Optimized for maximum throughput and minimum latency
# Suitable for high-traffic environments and low-latency requirements

# =============================================================================
# SERVER IDENTIFICATION
# =============================================================================
server_name = high-performance-ntp
server_description = High-Performance NTP Server - Optimized for Low Latency

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
# Bind to all interfaces for maximum accessibility
listen_address = 0.0.0.0
listen_port = 123

# Enable IPv6 for dual-stack support
enable_ipv6 = true

# High connection limits for busy environments
max_connections = 50000
connection_timeout = 15

# Network interface binding (optional - uncomment and modify as needed)
# bind_interfaces = eth0, eth1

# =============================================================================
# UPSTREAM SERVER CONFIGURATION
# =============================================================================
# Multiple upstream servers for redundancy and accuracy
upstream_servers = pool.ntp.org, time.nist.gov, time.google.com, time.cloudflare.com

# Backup servers for failover
backup_servers = time.windows.com, time.apple.com, time.aws.com

# Aggressive server selection for best performance
server_selection = priority
failover_enabled = true
failover_timeout = 5

# =============================================================================
# NTP SERVER CONFIGURATION
# =============================================================================
# High stratum for internal network
stratum = 2

# Reference identification
reference_id = HPPS
reference_clock = HIGH_PERFORMANCE

# Aggressive synchronization for low latency
sync_interval = 16
timeout = 500

# Enable local clock as backup
local_clock = true
local_clock_precision = -8

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================
# High worker thread count for maximum concurrency
worker_threads = 16
thread_pool_size = 64

# Memory optimization
max_memory_usage = 1GB
connection_buffer_size = 16KB

# Enable all performance features
enable_connection_pooling = true
enable_memory_pooling = true
enable_async_io = true
enable_response_cache = true

# Cache configuration for high performance
cache_ttl = 60
max_cache_size = 10000

# Performance monitoring
enable_performance_monitoring = true
performance_metrics_interval = 30

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# Minimal logging for performance
log_level = WARNING
enable_console_logging = false
enable_file_logging = true
enable_syslog = false

# High-performance logging
log_file = /var/log/simple-ntpd/high-performance.log
log_file_max_size = 100MB
log_file_backups = 10
log_rotation = daily

# Structured logging for analysis
log_structured = true
log_timestamp = true
log_thread_id = false
log_source_file = false

# Performance-focused logging
log_ntp_requests = false
log_ntp_responses = false
log_errors = true
log_performance = true

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
# Network access control
allowed_networks = 10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12
denied_networks = 

# Rate limiting for DDoS protection
max_requests_per_minute = 120
enable_query_restrictions = true
restrict_queries = false

# DDoS protection
enable_ddos_protection = true
max_connections_per_ip = 100
connection_rate_limit = 1000

# Authentication (optional - enable if needed)
enable_authentication = false
# authentication_key = your-secret-key
# authentication_algorithm = sha256

# =============================================================================
# ADVANCED FEATURES
# =============================================================================
# Enable advanced NTP features
enable_leap_second_handling = true
enable_interleaved_mode = true
enable_burst_mode = true

# Precision timing
enable_high_precision_timestamps = true
timestamp_precision = -9

# Network optimization
enable_tcp_nodelay = true
enable_so_reuseaddr = true
enable_so_keepalive = true

# =============================================================================
# MONITORING AND METRICS
# =============================================================================
# Health check endpoint
enable_health_check = true
health_check_port = 8080
health_check_path = /health

# Metrics collection
enable_metrics = true
metrics_port = 9090
metrics_path = /metrics

# Prometheus format
metrics_format = prometheus
metrics_interval = 15

# =============================================================================
# SYSTEM INTEGRATION
# =============================================================================
# Process management
daemonize = true
pid_file = /var/run/simple-ntpd.pid
user = ntp
group = ntp

# File permissions
umask = 022

# Resource limits
max_open_files = 65536
max_processes = 1024

# =============================================================================
# DEBUGGING AND TROUBLESHOOTING
# =============================================================================
# Debug mode (disable in production)
debug_mode = false
debug_level = 0

# Core dumps
enable_core_dumps = false
core_dump_dir = /var/crash

# =============================================================================
# NOTES AND RECOMMENDATIONS
# =============================================================================
# This configuration is optimized for:
# - High throughput (50,000+ concurrent connections)
# - Low latency (<1ms response time)
# - High availability (multiple upstream servers)
# - Performance monitoring and metrics
#
# Recommended system requirements:
# - CPU: 8+ cores
# - RAM: 8GB+ 
# - Network: 10Gbps+
# - Storage: SSD with high IOPS
#
# Monitor these metrics:
# - Response time percentiles (p50, p95, p99)
# - Connection count and throughput
# - Memory usage and GC activity
# - Network I/O and packet loss
#
# Tune these parameters based on your environment:
# - worker_threads: Match CPU core count
# - connection_buffer_size: Based on network MTU
# - cache_ttl: Based on network stability
# - max_connections: Based on expected load
